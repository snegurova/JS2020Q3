(()=>{"use strict";var e=function e(t,l,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.value=t,this.x=l,this.y=n,this.width=i,this.height=i,this.draggable=!1,this.moving=!1,this.startX=null,this.startY=null,this.xPosition=null,this.yPosition=null};function t(e,t){for(var l=0;l<t.length;l++){var n=t[l];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var l=function(){function l(e,t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),this.cells=[],this.cellSize=e,this.cellCount=t,this.totalCellCount=t*t,this.ctx=n,this.clicks=0,this.createCells(this.cellSize,this.cellCount),this.clicksCount=0,this.moves=[],this.dragging=!1}var n,i;return n=l,(i=[{key:"createCells",value:function(t,l){for(var n=0;n<this.totalCellCount;n++){var i=n%l,o=Math.trunc(n/l);this.cells.push(new e(n===this.totalCellCount-1?0:n+1,i,o,t))}}},{key:"getClicks",value:function(){return this.clicks}},{key:"drawCell",value:function(e,t){var l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.ctx.fillStyle=l?"rgba(255, 185, 59, 0.8)":"#FFB93B",this.ctx.fillRect(e+1,t+1,this.cellSize-2,this.cellSize-2)}},{key:"drawNum",value:function(e,t,l){this.ctx.font="bold ".concat(this.cellSize/2,"px Sans"),this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillStyle="#222",this.ctx.fillText(e,t,l)}},{key:"getEmptyCell",value:function(){return this.cells.find((function(e){return 0===e.value}))}},{key:"draw",value:function(){var e=this;this.cells.forEach((function(t,l){t.value>0&&!t.moving&&(e.drawCell(t.x*e.cellSize,t.y*e.cellSize,t.value===l+1),e.drawNum(t.value,t.x*e.cellSize+e.cellSize/2,t.y*e.cellSize+e.cellSize/2))}))}},{key:"move",value:function(e){var t=this,l=this.getEmptyCell(),n="",i=function(){l.value=e.value,e.value=0,t.clicks++,t.moves.push(n),t.cells.forEach((function(e){return e.draggable=!1})),e.x-1>=0&&(t.getCell(e.x-1,e.y).draggable=!0),e.x+1<=t.cellCount-1&&(t.getCell(e.x+1,e.y).draggable=!0),e.y-1>=0&&(t.getCell(e.x,e.y-1).draggable=!0),e.y+1<=t.cellCount-1&&(t.getCell(e.x,e.y+1).draggable=!0)};e.x-1===l.x&&e.y===l.y&&(n="left",i()),e.x+1===l.x&&e.y===l.y&&(n="right",i()),e.y-1===l.y&&e.x===l.x&&(n="up",i()),e.y+1===l.y&&e.x===l.x&&(n="down",i())}},{key:"isWon",value:function(){var e=this;return this.cells.every((function(t,l,n){return t.value===e.totalCellCount-1&&l===e.totalCellCount-2||0===t.value&&l===e.totalCellCount-1||t.value+1===n[l+1].value}))}},{key:"getCell",value:function(e,t){return this.cells.find((function(l){return l.x===e&&l.y===t}))}},{key:"mix",value:function(e){for(var t=function(){return 0===Math.floor(2*Math.random())},l=null,n=null,i=0;i<e;i++){var o=this.getEmptyCell(),a=t(),r=t();a||r||(l=o.x-1,n=o.y),a&&!r&&(l=o.x,n=o.y+1),!a&&r&&(l=o.x+1,n=o.y),a&&r&&(l=o.x,n=o.y-1),0<=l&&l<=this.cellCount-1&&0<=n&&n<=this.cellCount-1&&this.move(this.getCell(l,n))}this.clicks=0}}])&&t(n.prototype,i),l}(),n=document.createElement("div");n.classList.add("info-wrapper"),n.innerHTML='\n  <div  class="timer-wrapper">\n    <div>Time spent</div>\n    <div id ="timer" class="timer">0:00:00</div>\n  </div>\n  <div  class="cells-count-wrapper">\n    <select name="cells-count" id="cells-count">\n      <option value="3">3 x 3</option>\n      <option value="4" selected>4 x 4</option>\n      <option value="5">5 x 5</option>\n      <option value="6">6 x 6</option>\n      <option value="7">7 x 7</option>\n      <option value="8">8 x 8</option>\n    </select>\n  </div>\n  <div  class="moves-wrapper">\n    <div>Moves done</div>\n    <div id ="moves" class="moves">0</div>\n  </div>\n  ',document.body.appendChild(n);var i=document.createElement("div");i.classList.add("controls-wrapper"),i.innerHTML='\n  <div id ="reset-button" class="reset-button" title="Reset/Delete game"></div>\n  <div id ="resume-button" class="resume-button" title="Restore game"></div>\n  <div id ="pause-button" class="pause-button" title="Save game"></div>\n  ',document.body.appendChild(i);var o=document.querySelector("#reset-button"),a=document.querySelector("#pause-button"),r=document.querySelector("#resume-button"),c=document.querySelector("#moves"),s=document.querySelector("#cells-count"),u=s.options[s.selectedIndex].value,d=function(){return window.innerWidth>640?Math.floor(400/u):Math.floor(320/u)},v=d(),h=v*u,g=document.createElement("div");document.body.appendChild(g),g.classList.add("canvas-wrapper");var m=document.createElement("canvas");m.width=h,m.height=h;var f=m.getContext("2d");g.appendChild(m),f.fillRect(0,0,m.width,m.height);var p=new l(v,u,f);p.mix(Math.floor(Math.random()*u*20+10*u)),p.draw();var y=document.createElement("div");function x(e){var t=Math.trunc((e.pageX-m.offsetLeft)/p.cellSize),l=Math.trunc((e.pageY-m.offsetTop)/p.cellSize);p.move(p.getCell(t,l)),f.fillRect(0,0,m.width,m.height),p.draw(),p.isWon()&&(y.innerHTML="Solved in ".concat(p.getClicks()," moves!")),c.innerText=p.getClicks()}y.classList.add("result-wrapper"),document.body.appendChild(y),m.addEventListener("click",x),m.addEventListener("mousedown",(function(e){e.preventDefault(),e.stopPropagation(),m.addEventListener("click",x);var t=Math.trunc((e.pageX-m.offsetLeft)/p.cellSize),l=Math.trunc((e.pageY-m.offsetTop)/p.cellSize),n=Math.trunc(e.pageX-m.offsetLeft),i=Math.trunc(e.pageY-m.offsetTop),o=p.getCell(t,l);o.draggable&&(p.dragging=!0,o.moving=!0,o.startX=n,o.startY=i,o.xPosition=o.x*p.cellSize,o.yPosition=o.y*p.cellSize)})),m.addEventListener("mouseup",(function(e){e.preventDefault(),e.stopPropagation();var t=p.cells.find((function(e){return e.moving}));p.dragging=!1,p.cells.forEach((function(e){e.moving=!1,e.xPosition=null,e.yPosition=null}));var l=Math.trunc((e.pageX-m.offsetLeft)/p.cellSize),n=Math.trunc((e.pageY-m.offsetTop)/p.cellSize),i=p.getEmptyCell();i.x===l&&i.y===n?(p.move(t),c.innerText=p.getClicks(),f.fillRect(0,0,m.width,m.height),p.draw(),p.isWon()&&(y.innerHTML="Solved in ".concat(p.getClicks()," moves!"))):(f.fillRect(0,0,m.width,m.height),p.draw())})),m.addEventListener("mousemove",(function(e){if(p.dragging){e.preventDefault(),e.stopPropagation(),m.removeEventListener("click",x);var t=Math.trunc(e.pageX-m.offsetLeft),l=Math.trunc(e.pageY-m.offsetTop),n=p.cells.find((function(e){return e.moving})),i=t-n.startX,o=l-n.startY;n.xPosition+=i,n.yPosition+=o,f.fillRect(0,0,m.width,m.height),p.draw(),p.drawCell(n.xPosition,n.yPosition,!0),p.drawNum(n.value,n.xPosition+p.cellSize/2,n.yPosition+p.cellSize/2),n.startX=t,n.startY=l}})),o.addEventListener("click",(function(e){e.preventDefault(),localStorage.removeItem("movesArray"),localStorage.removeItem("movesCount"),localStorage.removeItem("time"),localStorage.removeItem("cells"),f.fillRect(0,0,m.width,m.height),p.mix(Math.floor(Math.random()*u*20+10*u)),p.draw(),S.innerHTML="0:00:00",p.moves.splice(0),p.clicks=0,c.innerText=p.getClicks()})),window.addEventListener("resize",(function(){p.cellSize=d(),h=p.cellSize*u,m.width=h,m.height=h,f.fillRect(0,0,h,h),p.draw()}));var C=null,S=document.querySelector("#timer");function w(){var e=S.innerHTML.split(":"),t=e[0],l=e[1],n=e[2];59===parseInt(n)?(n="00",59===parseInt(l)?(l="00",t++):l=++l<10?"0".concat(l):l):n=++n<10?"0".concat(n):n,S.innerHTML="".concat(t,":").concat(l,":").concat(n)}C=setInterval(w,1e3),a.addEventListener("click",(function(){clearInterval(C),C=null,localStorage.setItem("movesArray",p.moves),localStorage.setItem("movesCount",p.clicks),localStorage.setItem("time",S.innerHTML),localStorage.setItem("cells",JSON.stringify(p.cells))})),r.addEventListener("click",(function(){C||(C=setInterval(w,1e3)),p.moves=localStorage.getItem("movesArray").split(","),S.innerHTML=localStorage.getItem("time"),c.innerHTML=localStorage.getItem("movesCount"),p.cells=JSON.parse(localStorage.getItem("cells")),f.fillRect(0,0,m.width,m.height),p.draw()})),window.addEventListener("DOMContentLoaded",(function(){localStorage.getItem("time")&&(p.moves=localStorage.getItem("movesArray").split(","),S.innerHTML=localStorage.getItem("time"),p.clicks=localStorage.getItem("movesCount"),c.innerHTML=localStorage.getItem("movesCount"),p.cells=JSON.parse(localStorage.getItem("cells")),f.fillRect(0,0,m.width,m.height),p.draw())}))})();
